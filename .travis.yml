language: python
python:
  - "2.7"
  - "3.7"
cache: pip
services:
  - docker

env:
  global:
    - COLLECTION_NAMESPACE=devroles
    - COLLECTION_NAME=system
  jobs:
    - SCENARIO=sudoers
    - SCENARIO=authorized_key

install:
  - pip install -U pip
  - pip --version
  - pip install tox tox-travis
  - mkdir -p ~/.ssh  # Needed by authorized_key
  - touch ~/.ssh/id_rsa.pub

before_script:
  - cd ..
  - pwd
  # ansible collections need to be in an ansible_colection path
  - mkdir -p "ansible_collections/${COLLECTION_NAMESPACE}"
  - mv "$(basename "${TRAVIS_REPO_SLUG}")" "ansible_collections/${COLLECTION_NAMESPACE}/${COLLECTION_NAME}"
  - find . -type d
  - cd "ansible_collection/${COLLECTION_NAMESPACE}/${COLLECTION_NAME}"

script:
  - tox

# Notifications are for galaxy roles - I don't know that they're yet
# a thing for collections
#notifications:
  #webhooks: https://galaxy.ansible.com/api/v1/notifications/
